---
alwaysApply: true
---

# üéØ R√®gles Projet - Dashboard KPI Energysoft

## üìä Contexte du Projet

**Objectif Principal:** Cr√©er un dashboard KPI interactif, modulaire et design pour l'analyse des donn√©es de maintenance et performance Energysoft.

**Donn√©es Principales:**
- **Excel:** `All Stats Energysoft.xlsx` (source principale)
- **SQLite:** `energysoft_stats.db` (base de donn√©es op√©rationnelle)
- **Dashboard:** `dashboard.py` (application Streamlit)

## üîß MCP Disponibles et Utilisation Automatique

### Mapping Automatique Demande ‚Üí MCP

| Type de Demande | MCP √† Utiliser | Outils Cl√©s |
|----------------|----------------|-------------|
| Lecture/Modification Excel | `excel` | read_excel, write_excel, list_sheets |
| Requ√™tes/Modifications SQLite | `sqlite` | query, list_tables, get_schema |
| Manipulations dates/temps | `mcp-time` | current_time, relative_time, convert_timezone |
| Analyses/Transformations | `pandas` | groupby_analysis, pivot_table, merge |
| Visualisations/Graphiques | `plotly` | create_bar_chart, create_line_chart, timeline |
| Pr√©dictions/ML | `ml` | predict_trend, detect_anomalies, forecast |
| Statistiques avanc√©es | `statistics` | correlation, hypothesis_test, regression |

## üéØ R√®gles d'Utilisation Automatique par Contexte

### Contexte: Fichier Excel

**D√©clencheurs automatiques:**
- Mention de "Excel", "All Stats Energysoft", ".xlsx"
- Demande de lecture/extraction/modification de donn√©es Excel
- Besoin de lire une feuille sp√©cifique
- Export de donn√©es vers Excel

**Action:** **TOUJOURS** utiliser `excel` MCP en premier

**Workflow typique:**
```
1. excel MCP ‚Üí list_sheets() pour voir les feuilles disponibles
2. excel MCP ‚Üí read_excel() pour extraire les donn√©es
3. Si transformation n√©cessaire ‚Üí pandas MCP
4. Si visualisation ‚Üí plotly MCP
```

### Contexte: Base SQLite

**D√©clencheurs automatiques:**
- Mention de "SQLite", "base de donn√©es", "db"
- Nom de table (interventions, ticket.operator, etc.)
- Demande de requ√™te SQL
- CRUD op√©rations

**Action:** **TOUJOURS** utiliser `sqlite` MCP

**Workflow typique:**
```
1. sqlite MCP ‚Üí list_tables() pour explorer
2. sqlite MCP ‚Üí query() pour extraire donn√©es
3. Si analyses ‚Üí pandas MCP ou statistics MCP
4. Si visualisation ‚Üí plotly MCP
```

### Contexte: Analyses Temporelles

**D√©clencheurs automatiques:**
- Mention de dates, p√©riodes, "mois", "semaine", "ann√©e"
- "Depuis", "jusqu'√†", "entre"
- Agr√©gations temporelles
- Conversions timezone

**Action:** **TOUJOURS** utiliser `mcp-time` MCP pour manipulations dates

**Workflow typique:**
```
1. mcp-time MCP ‚Üí convert_timezone() si n√©cessaire
2. mcp-time MCP ‚Üí relative_time() pour parsing naturel
3. sqlite MCP ‚Üí query avec filtres temporels
4. pandas MCP ‚Üí groupby par p√©riode
5. plotly MCP ‚Üí timeline_chart pour visualiser
```

### Contexte: Visualisations

**D√©clencheurs automatiques:**
- "Graphique", "chart", "visualiser", "courbe"
- "Barre", "ligne", "camembert", "map", "carte"
- "Dashboard", "tableau de bord"

**Action:** **TOUJOURS** utiliser `plotly` MCP pour g√©n√©rer graphiques

**Workflow typique:**
```
1. Extraire donn√©es (sqlite ou excel MCP)
2. Pr√©parer avec pandas MCP si n√©cessaire
3. plotly MCP ‚Üí create_*_chart()
4. Int√©grer dans dashboard.py (Streamlit)
```

### Contexte: Machine Learning

**D√©clencheurs automatiques:**
- "Pr√©dire", "pr√©diction", "forecast", "tendance future"
- "Anomalie", "d√©tecter anomalie"
- "Classification", "sc√©nario", "what-if"

**Action:** **TOUJOURS** utiliser `ml` MCP

**Workflow typique:**
```
1. Extraire donn√©es (sqlite MCP)
2. Pr√©parer avec pandas MCP
3. ml MCP ‚Üí predict_trend() ou detect_anomalies()
4. Visualiser avec plotly MCP
5. Int√©grer dans dashboard avec indicateurs ML
```

### Contexte: Analyses Statistiques

**D√©clencheurs automatiques:**
- "Corr√©lation", "statistiques", "test"
- "R√©gression", "hypoth√®se", "ANOVA"
- "Comparer groupes", "significativit√©"

**Action:** **TOUJOURS** utiliser `statistics` MCP

**Workflow typique:**
```
1. Extraire donn√©es (sqlite MCP)
2. statistics MCP ‚Üí calculate_correlation() ou regression_analysis()
3. Pr√©senter r√©sultats avec interpr√©tations
4. Visualiser avec plotly MCP
```

## üé® Standards Dashboard

### Structure Dashboard Streamlit

**Obligatoire:**
- Layout wide (`st.set_page_config(layout="wide")`)
- Sidebar pour filtres
- Sections modulaires (KPI, Graphiques, Analyses, ML)
- Cache des donn√©es (`@st.cache_data`)
- Gestion d'erreurs robuste

### Composants Standards

**1. En-t√™te:**
```python
st.title("üìä Dashboard Energysoft")
st.markdown("---")
```

**2. KPI Cards:**
```python
col1, col2, col3, col4 = st.columns(4)
with col1:
    st.metric("Interventions", value, delta)
```

**3. Filtres Sidebar:**
```python
with st.sidebar:
    st.date_input("Date d√©but", ...)
    st.selectbox("Site", ...)
```

**4. Graphiques Plotly:**
```python
fig = plotly_figure_from_mcp()
st.plotly_chart(fig, use_container_width=True)
```

### Design Guidelines

- **Couleurs:** Palette coh√©rente (bleu √©nerg√©tique #1f77b4)
- **Responsive:** Adapt√© √† toutes les tailles d'√©cran
- **Interactif:** Filtres, s√©lecteurs, zooms
- **Performance:** Cache, requ√™tes optimis√©es
- **Accessibilit√©:** Labels clairs, contraste

## üìà Types de KPI √† Calculer Automatiquement

Quand l'utilisateur demande un dashboard ou des analyses:

**KPI de Maintenance:**
- Nombre total d'interventions
- Taux de r√©solution
- Temps moyen de r√©solution
- Co√ªt moyen par intervention
- Top sites par nombre d'interventions

**KPI de Performance:**
- √âvolution temporelle des interventions
- Distribution par op√©rateur
- Tendances saisonni√®res
- Pr√©dictions futures

**KPI d'Analyses:**
- Corr√©lations entre variables
- D√©tection d'anomalies
- Comparaisons de groupes
- R√©gressions

## üó∫Ô∏è Cartographie (Maps)

Si donn√©es g√©ographiques disponibles:
- Utiliser Plotly Geo ou Folium
- Cr√©er maps interactives des sites
- Visualiser interventions par localisation
- Heatmaps g√©ographiques

## üîÑ Workflows Complets Recommand√©s

### Workflow: Analyse Compl√®te

```
1. excel MCP ‚Üí Extraire donn√©es Excel
2. sqlite MCP ‚Üí Importer dans SQLite (si n√©cessaire)
3. sqlite MCP ‚Üí Requ√™tes d'analyse
4. pandas MCP ‚Üí Transformations
5. statistics MCP ‚Üí Analyses statistiques
6. ml MCP ‚Üí Pr√©dictions/anomalies
7. plotly MCP ‚Üí Visualisations
8. dashboard.py ‚Üí Int√©gration Streamlit
```

### Workflow: Dashboard Interactif

```
1. sqlite MCP ‚Üí Extraire donn√©es principales
2. mcp-time MCP ‚Üí Pr√©parer filtres temporels
3. pandas MCP ‚Üí Calculer KPI
4. plotly MCP ‚Üí G√©n√©rer tous les graphiques
5. Modifier dashboard.py avec:
   - Sections modulaires
   - Filtres interactifs
   - Graphiques Plotly int√©gr√©s
   - Design moderne
```

### Workflow: Analyses ML Avanc√©es

```
1. sqlite MCP ‚Üí Dataset complet
2. pandas MCP ‚Üí Feature engineering
3. ml MCP ‚Üí Pr√©dictions/anomalies/classification
4. statistics MCP ‚Üí Validation statistique
5. plotly MCP ‚Üí Visualiser pr√©dictions
6. Int√©grer dans dashboard avec onglet ML
```

## üö´ Ce Qui Est Interdit

- ‚ùå √âcrire du code qui lit Excel directement avec pandas (utiliser excel MCP)
- ‚ùå Faire des requ√™tes SQL directes sans sqlite MCP
- ‚ùå Cr√©er des graphiques statiques (toujours utiliser plotly MCP)
- ‚ùå Ignorer les optimisations de performance
- ‚ùå Cr√©er des dashboards non-modulaires

## ‚úÖ Ce Qui Est Obligatoire

- ‚úÖ Utiliser les MCP pour toutes les op√©rations de donn√©es
- ‚úÖ Combiner plusieurs MCP quand pertinent
- ‚úÖ Cr√©er des dashboards modulaires et r√©utilisables
- ‚úÖ Ajouter gestion d'erreurs compl√®te
- ‚úÖ Optimiser les performances (cache, index)
- ‚úÖ Proposer des am√©liorations proactives

## üîÑ Synchronisation GitHub Automatique

### R√®gle de Synchronisation Continue

**√Ä chaque modification du projet** (nouveau d√©veloppement, modification de code, ajout de fichiers, etc.), l'Agent Cursor **DOIT** :

1. **D√©tecter automatiquement les changements**
   - Fichiers modifi√©s, cr√©√©s, ou supprim√©s
   - Changements dans le code source
   - Ajout de nouvelles fonctionnalit√©s
   - Corrections de bugs

2. **Proposer syst√©matiquement la synchronisation GitHub**
   - Apr√®s chaque modification significative
   - √Ä la fin de chaque t√¢che de d√©veloppement
   - Avant de terminer une session de travail

3. **Processus de proposition :**
   ```
   "üîÑ Modifications d√©tect√©es ! Voulez-vous synchroniser avec GitHub ?
   
   Fichiers modifi√©s :
   - dashboard_apex.py (ajout nouvelle fonctionnalit√©)
   - requirements.txt (nouvelle d√©pendance)
   
   Proposer commit et push vers GitHub ? (O/n)"
   ```

4. **Si l'utilisateur accepte :**
   - ‚úÖ V√©rifier l'√©tat Git (`git status`)
   - ‚úÖ Ajouter les fichiers modifi√©s (`git add`)
   - ‚úÖ Cr√©er un commit avec message descriptif
   - ‚úÖ Proposer le push vers GitHub (`git push origin main`)
   - ‚úÖ Informer de la synchronisation r√©ussie

5. **Message de commit automatique :**
   - D√©crire clairement les changements
   - Format : `"Description courte - D√©tails des modifications"`
   - Exemple : `"Am√©lioration dashboard - Ajout filtres par date et graphique performance"`

### D√©p√¥t GitHub Cible

- **Repository :** `https://github.com/GlennCoche/Dashboard`
- **Branche principale :** `main`
- **D√©ploiement automatique :** Streamlit Cloud se synchronise automatiquement apr√®s push

### Workflow Complet

**Apr√®s chaque modification de code :**

```
1. Fin du d√©veloppement/modification
2. Agent propose : "Synchroniser avec GitHub ?"
3. Si accept√© ‚Üí git add, git commit, git push
4. Confirmation : "‚úÖ Synchronis√© avec GitHub"
5. Info : "Streamlit Cloud red√©ploiera automatiquement dans ~1-2 min"
```

### Cas Particuliers

- **Modifications mineures :** Proposer quand m√™me la synchronisation
- **Plusieurs modifications :** Regrouper en un seul commit descriptif
- **Erreurs Git :** Informer l'utilisateur et proposer une solution
- **Conflits :** D√©tecter et proposer r√©solution

### Important

- ‚ö†Ô∏è **NE JAMAIS** pusher automatiquement sans confirmation utilisateur
- ‚ö†Ô∏è **TOUJOURS** demander confirmation avant `git push`
- ‚úÖ **TOUJOURS** proposer la synchronisation apr√®s modifications
- ‚úÖ Maintenir le d√©p√¥t GitHub √† jour en permanence

### Commandes Git √† Utiliser

```bash
# V√©rifier l'√©tat
git status

# Ajouter fichiers
git add [fichiers_modifi√©s]

# Cr√©er commit descriptif
git commit -m "Description claire des modifications"

# Push vers GitHub
git push origin main
```

---

## üéØ Priorit√©s

1. **Autonomie:** Utiliser les MCP sans demander
2. **Performance:** Optimiser requ√™tes et cache
3. **Modularit√©:** Code r√©utilisable et modulaire
4. **UX:** Design moderne et interactif
5. **Fiabilit√©:** Gestion d'erreurs compl√®te

---

**Objectif Final:** Un dashboard KPI professionnel, interactif, modulaire et performant, utilisant automatiquement tous les MCP disponibles pour offrir la meilleure exp√©rience possible.
